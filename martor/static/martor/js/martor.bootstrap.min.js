/**
 * Name         : Martor v1.6.10
 * Created by   : Agus Makmun (Summon Agus)
 * Release date : 26-Jan-2022
 * License      : GNU GENERAL PUBLIC LICENSE Version 3, 29 June 2007
 * Repository   : https://github.com/agusmakmun/django-markdown-editor
**/
!function(e){$=e.jQuery,$.fn.martor=function(){$(".martor").trigger("martor.init");var e=function(e){var n=null,o=0;if(document.cookie&&""!==document.cookie)for(var t=document.cookie.split(";");o<t.length;o++){var a=jQuery.trim(t[o]);if(a.substring(0,e.length+1)===e+"="){n=decodeURIComponent(a.substring(e.length+1));break}}return n};this.each(function(n,o){var t=$(o),a=t.data("field-name"),i=$("#id_"+a),s="martor-"+a,r=ace.edit(s),c=JSON.parse(i.data("enable-configs").replace(/'/g,'"'));r.setTheme("ace/theme/github"),r.getSession().setMode("ace/mode/markdown"),r.getSession().setUseWrapMode(!0),r.$blockScrolling=1/0,r.renderer.setScrollMargin(10,10),r.setAutoScrollEditorIntoView(!0),r.setShowPrintMargin(!1),r.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0,enableMultiselect:!1}),"true"==c.living&&$(o).addClass("enable-living");var l={getCompletions:function(e,n,o,t,a){var i="undefined"!=typeof emojis?emojis:[],s=e.getSession().getTokenAt(o.row,o.column.count);if(void 0!==s.value){var r=s.value.split(/\s+/);":"==r[r.length-1][0]&&a(null,i.map(function(e){return{caption:e,value:e.replace(":","")+" ",meta:"emoji"}}))}}},m={getCompletions:function(n,o,t,a,s){var r=n.getSession().getTokenAt(t.row,t.column.count);if(void 0!==r.value){var c=r.value.split(/\s+/),l=c[c.length-1];"@"==l[0]&&"["==l[1]&&(username=l.replace(/([\@\[/\]/])/g,""),$.ajax({url:i.data("search-users-url"),data:{username:username,csrfmiddlewaretoken:e("csrftoken")},success:function(e){if(200==e.status){for(var n=[],o=0;o<e.data.length;o++)n.push(e.data[o].username);s(null,n.map(function(e){return{caption:e,value:e,meta:"username"}}))}}}))}}};"true"===c.mention?r.completers=[l,m]:r.completers=[l],i.attr({style:"display:none"}),$(o).find(".martor-toolbar").find(".markdown-selector").attr({"data-field-name":a}),$(o).find(".upload-progress").attr({"data-field-name":a}),$(o).find(".modal-help-guide").attr({"data-field-name":a}),$(o).find(".modal-emoji").attr({"data-field-name":a}),r.on("change",function(e){var n=r.getValue();i.val(n)}),$("#"+s).resizable({direction:"bottom",stop:function(){r.resize()}});var d=$(".tab-pane#nav-preview-"+a),u=$(".nav-link#nav-editor-tab-"+a),f=$(".nav-link#nav-preview-tab-"+a);$(this).closest(".tab-martor-menu").find(".martor-toolbar");u.click(function(){$(this).closest(".tab-martor-menu").find(".martor-toolbar").show()}),f.click(function(){$(this).closest(".tab-martor-menu").find(".martor-toolbar").hide()});var g=function(){var n=i.val(),o=new FormData;o.append("content",n),o.append("csrfmiddlewaretoken",e("csrftoken")),d.addClass("martor-preview-stale"),$.ajax({url:i.data("markdownfy-url"),type:"POST",data:o,processData:!1,contentType:!1,success:function(e){e?(d.html(e).removeClass("martor-preview-stale"),$(document).trigger("martor:preview",[d]),"true"==c.hljs&&$("pre").each(function(e,n){hljs.highlightBlock(n)})):d.html("<p>Nothing to preview</p>")},error:function(e){console.log("error",e)}})};if(window.onload=function(){g()},"true"!==c.living?f.click(function(){$(this).closest(".tab-martor-menu").find(".martor-toolbar").hide(),g()}):r.on("change",g),"true"==c.spellcheck)try{enable_spellcheck(s)}catch(e){console.log("Spellcheck lib doesn't installed.")}var v=function(e){var n=e.getSelectionRange();if(e.selection.isEmpty()){var o=e.getCursorPosition();e.session.insert(o," **** "),e.focus(),e.selection.moveTo(o.row,o.column+3)}else{var t=e.getSelectionRange(),a=e.session.getTextRange(t);e.session.replace(t,"**"+a+"**"),n.end.column+=4,e.focus(),e.selection.setSelectionRange(n)}},p=function(e){var n=e.getSelectionRange();if(e.selection.isEmpty()){var o=e.getCursorPosition();e.session.insert(o," __ "),e.focus(),e.selection.moveTo(o.row,o.column+2)}else{var t=e.getSelectionRange(),a=e.session.getTextRange(t);e.session.replace(t,"_"+a+"_"),n.end.column+=2,e.focus(),e.selection.setSelectionRange(n)}},w=function(e){var n=e.getSelectionRange();if(e.selection.isEmpty()){var o=e.getCursorPosition();e.session.insert(o,"\n\n----------\n\n"),e.focus(),e.selection.moveTo(o.row+4,o.column+10)}else{var t=e.getSelectionRange(),a=e.session.getTextRange(t);e.session.replace(t,"\n\n----------\n\n"+a),e.focus(),e.selection.moveTo(n.end.row+4,n.end.column+10)}},k=function(e){var n=e.getSelectionRange();if(e.selection.isEmpty()){var o=e.getCursorPosition();e.session.insert(o,"\n\n# "),e.focus(),e.selection.moveTo(o.row+2,o.column+2)}else{var t=e.getSelectionRange(),a=e.session.getTextRange(t);e.session.replace(t,"\n\n# "+a+"\n"),e.focus(),e.selection.moveTo(n.end.row+2,n.end.column+2)}},h=function(e){var n=e.getSelectionRange();if(e.selection.isEmpty()){var o=e.getCursorPosition();e.session.insert(o,"\n\n## "),e.focus(),e.selection.moveTo(o.row+2,o.column+3)}else{var t=e.getSelectionRange(),a=e.session.getTextRange(t);e.session.replace(t,"\n\n## "+a+"\n"),e.focus(),e.selection.moveTo(n.end.row+2,n.end.column+3)}},C=function(e){var n=e.getSelectionRange();if(e.selection.isEmpty()){var o=e.getCursorPosition();e.session.insert(o,"\n\n### "),e.focus(),e.selection.moveTo(o.row+2,o.column+4)}else{var t=e.getSelectionRange(),a=e.session.getTextRange(t);e.session.replace(t,"\n\n### "+a+"\n"),e.focus(),e.selection.moveTo(n.end.row+2,n.end.column+4)}},y=function(e){var n=e.getSelectionRange();if(e.selection.isEmpty()){var o=e.getCursorPosition();e.session.insert(o,"\n\n```\n\n```\n"),e.focus(),e.selection.moveTo(o.row+3,o.column)}else{var t=e.getSelectionRange(),a=e.session.getTextRange(t);e.session.replace(t,"\n\n```\n"+a+"\n```\n"),e.focus(),e.selection.moveTo(n.end.row+3,n.end.column+3)}},T=function(e){var n=e.getSelectionRange();if(e.selection.isEmpty()){var o=e.getCursorPosition();e.session.insert(o," `` "),e.focus(),e.selection.moveTo(o.row,o.column+2)}else{var t=e.getSelectionRange(),a=e.session.getTextRange(t);e.session.replace(t,"`"+a+"`"),n.end.column+=2,e.focus(),e.selection.setSelectionRange(n)}},S=function(e){var n=e.getSelectionRange();if(e.selection.isEmpty()){var o=e.getCursorPosition();e.session.insert(o,"\n\n> \n"),e.focus(),e.selection.moveTo(o.row+2,o.column+2)}else{var t=e.getSelectionRange(),a=e.session.getTextRange(t);e.session.replace(t,"\n\n> "+a+"\n"),e.focus(),e.selection.moveTo(n.end.row+2,n.end.column+2)}},b=function(e){var n=e.getSelectionRange();if(e.selection.isEmpty()){var o=e.getCursorPosition();e.session.insert(o,"\n\n* "),e.focus(),e.selection.moveTo(o.row+2,o.column+2)}else{var t=e.getSelectionRange(),a=e.session.getTextRange(t);e.session.replace(t,"\n\n* "+a),e.focus(),e.selection.moveTo(n.end.row+2,n.end.column+2)}},R=function(e){var n=e.getSelectionRange();if(e.selection.isEmpty()){var o=e.getCursorPosition();e.session.insert(o,"\n\n1. "),e.focus(),e.selection.moveTo(o.row+2,o.column+3)}else{var t=e.getSelectionRange(),a=e.session.getTextRange(t);e.session.replace(t,"\n\n1. "+a),e.focus(),e.selection.moveTo(n.end.row+2,n.end.column+3)}},x=function(e){var n=e.getSelectionRange();if(e.selection.isEmpty()){var o=e.getCursorPosition();e.session.insert(o," [](https://) "),e.focus(),e.selection.moveTo(o.row,o.column+2)}else{var t=e.getSelectionRange(),a=e.session.getTextRange(t);e.session.replace(t,"["+a+"](https://) "),e.focus(),e.selection.moveTo(n.end.row,n.end.column+11)}},O=function(e,n){var o=e.getSelectionRange();if(void 0===n)if(e.selection.isEmpty()){var t=e.getCursorPosition();e.session.insert(t," ![](https://) "),e.focus(),e.selection.moveTo(t.row,t.column+3)}else{var a=e.getSelectionRange(),i=e.session.getTextRange(a);e.session.replace(a,"!["+i+"](https://) "),e.focus(),e.selection.moveTo(o.end.row,o.end.column+12)}else{t=e.getCursorPosition();e.session.insert(t,"!["+n.name+"]("+n.link+") "),e.focus(),e.selection.moveTo(t.row,t.column+n.name.length+2)}},j=function(e){var n=e.getSelectionRange();if(e.selection.isEmpty()){var o=e.getCursorPosition();e.session.insert(o," @[]"),e.focus(),e.selection.moveTo(o.row,o.column+3)}else{var t=e.getSelectionRange(),a=e.session.getTextRange(t);e.session.replace(t,"@["+a+"]"),e.focus(),e.selection.moveTo(n.end.row,n.end.column+3)}},P=function(e,n){var o=e.getCursorPosition();e.session.insert(o," "+n+" "),e.focus(),e.selection.moveTo(o.row,o.column+n.length+2)};r.commands.addCommand({name:"markdownToBold",bindKey:{win:"Ctrl-B",mac:"Command-B"},exec:function(e){v(e)},readOnly:!0}),r.commands.addCommand({name:"markdownToItalic",bindKey:{win:"Ctrl-I",mac:"Command-I"},exec:function(e){p(e)},readOnly:!0}),r.commands.addCommand({name:"markdownToUnderscores",bindKey:{win:"Ctrl-Shift-U",mac:"Command-Option-U"},exec:function(e){!function(e){var n=e.getSelectionRange();if(e.selection.isEmpty()){var o=e.getCursorPosition();e.session.insert(o," ++++ "),e.focus(),e.selection.moveTo(o.row,o.column+3)}else{var t=e.getSelectionRange(),a=e.session.getTextRange(t);e.session.replace(t,"++"+a+"++"),n.end.column+=4,e.focus(),e.selection.setSelectionRange(n)}}(e)},readOnly:!0}),r.commands.addCommand({name:"markdownToStrikethrough",bindKey:{win:"Ctrl-Shift-S",mac:"Command-Option-S"},exec:function(e){!function(e){var n=e.getSelectionRange();if(e.selection.isEmpty()){var o=e.getCursorPosition();e.session.insert(o," ~~~~ "),e.focus(),e.selection.moveTo(o.row,o.column+3)}else{var t=e.getSelectionRange(),a=e.session.getTextRange(t);e.session.replace(t,"~~"+a+"~~"),n.end.column+=4,e.focus(),e.selection.setSelectionRange(n)}}(e)},readOnly:!0}),r.commands.addCommand({name:"markdownToHorizontal",bindKey:{win:"Ctrl-H",mac:"Command-H"},exec:function(e){w(e)},readOnly:!0}),r.commands.addCommand({name:"markdownToH1",bindKey:{win:"Ctrl-Alt-1",mac:"Command-Option-1"},exec:function(e){k(e)},readOnly:!0}),r.commands.addCommand({name:"markdownToH2",bindKey:{win:"Ctrl-Alt-2",mac:"Command-Option-3"},exec:function(e){h(e)},readOnly:!0}),r.commands.addCommand({name:"markdownToH3",bindKey:{win:"Ctrl-Alt-3",mac:"Command-Option-3"},exec:function(e){C(e)},readOnly:!0}),r.commands.addCommand({name:"markdownToPre",bindKey:{win:"Ctrl-Alt-P",mac:"Command-Option-P"},exec:function(e){y(e)},readOnly:!0}),r.commands.addCommand({name:"markdownToCode",bindKey:{win:"Ctrl-Alt-C",mac:"Command-Option-C"},exec:function(e){T(e)},readOnly:!0}),r.commands.addCommand({name:"markdownToBlockQuote",bindKey:{win:"Ctrl-Q",mac:"Command-Q"},exec:function(e){S(e)},readOnly:!0}),r.commands.addCommand({name:"markdownToUnorderedList",bindKey:{win:"Ctrl-U",mac:"Command-U"},exec:function(e){b(e)},readOnly:!0}),r.commands.addCommand({name:"markdownToOrderedList",bindKey:{win:"Ctrl-Shift+O",mac:"Command-Option-O"},exec:function(e){R(e)},readOnly:!0}),r.commands.addCommand({name:"markdownToLink",bindKey:{win:"Ctrl-L",mac:"Command-L"},exec:function(e){x(e)},readOnly:!0}),r.commands.addCommand({name:"markdownToImageLink",bindKey:{win:"Ctrl-Shift-I",mac:"Command-Option-I"},exec:function(e){O(e)},readOnly:!0}),"true"===c.mention&&r.commands.addCommand({name:"markdownToMention",bindKey:{win:"Ctrl-M",mac:"Command-M"},exec:function(e){j(e)},readOnly:!0}),$(".markdown-bold[data-field-name="+a+"]").click(function(){v(r)}),$(".markdown-italic[data-field-name="+a+"]").click(function(){p(r)}),$(".markdown-horizontal[data-field-name="+a+"]").click(function(){w(r)}),$(".markdown-h1[data-field-name="+a+"]").click(function(){k(r)}),$(".markdown-h2[data-field-name="+a+"]").click(function(){h(r)}),$(".markdown-h3[data-field-name="+a+"]").click(function(){C(r)}),$(".markdown-pre[data-field-name="+a+"]").click(function(){y(r)}),$(".markdown-code[data-field-name="+a+"]").click(function(){T(r)}),$(".markdown-blockquote[data-field-name="+a+"]").click(function(){S(r)}),$(".markdown-unordered-list[data-field-name="+a+"]").click(function(){b(r)}),$(".markdown-ordered-list[data-field-name="+a+"]").click(function(){R(r)}),$(".markdown-link[data-field-name="+a+"]").click(function(){x(r)}),$(".markdown-image-link[data-field-name="+a+"]").click(function(){O(r)});var E=$(".markdown-direct-mention[data-field-name="+a+"]"),K=$(".markdown-image-upload[data-field-name="+a+"]");"true"==c.mention?E.click(function(){j(r)}):(E.remove(),$(".markdown-reference tbody tr")[1].remove()),"true"==c.imgur?K.on("change",function(n){n.preventDefault(),function(n){var o=$("#"+s).closest("form").get(0),t=n.container.id.replace("martor-",""),a=new FormData(o);a.append("csrfmiddlewaretoken",e("csrftoken")),$.ajax({url:i.data("upload-url"),type:"POST",data:a,async:!0,cache:!1,contentType:!1,enctype:"multipart/form-data",processData:!1,beforeSend:function(){console.log("Uploading..."),$(".upload-progress[data-field-name="+t+"]").show()},success:function(e){$(".upload-progress[data-field-name="+t+"]").hide(),200==e.status?(console.log(e),O(n=n,imageData={name:e.name,link:e.link})):alert(e.error)},error:function(e){console.log("error",e),$(".upload-progress[data-field-name="+t+"]").hide()}})}(r)}):K.remove(),$(".markdown-help[data-field-name="+a+"]").click(function(){$(".modal-help-guide[data-field-name="+a+"]").modal("show")});var A=$(".martor-field-"+a),M=$(".markdown-toggle-maximize[data-field-name="+a+"]"),U=function(){$(document.body).removeClass("overflow"),$(this).attr({title:"Full Screen"}),$(this).find("svg.bi-arrows-angle-expand").show(),$(this).find("svg.bi-arrows-angle-contract").hide(),$(".main-martor-fullscreen").find(".martor-preview").removeAttr("style"),t.removeClass("main-martor-fullscreen"),A.removeAttr("style"),r.resize()};M.on("click",function(){!function(e){e.attr({title:"Minimize"}),e.find("svg.bi-arrows-angle-expand").hide(),e.find("svg.bi-arrows-angle-contract").show(),t.addClass("main-martor-fullscreen");var n=document.body.clientHeight-90;A.attr({style:"height:"+n+"px"}),$(".main-martor-fullscreen").find(".martor-preview").attr({style:"overflow-y: auto;height:"+n+"px"}),r.resize(),e.one("click",U),$(document.body).addClass("overflow")}($(this))}),$(document).keyup(function(e){27==e.keyCode&&t.hasClass("main-martor-fullscreen")&&M.trigger("click")}),$(".markdown-emoji[data-field-name="+a+"]").click(function(){var e=$(".modal-emoji[data-field-name="+a+"]").modal("show"),n="undefined"!=typeof emojis?emojis:[],o=e.find(".emoji-content-body"),t=e.find(".emoji-loader-init");o.html(""),t.show(),e.show();for(var s=0;s<n.length;s++){var c=i.data("base-emoji-url")+n[s].replace(/:/g,"")+".png";o.append('<div class="col-md-4"><p><a data-emoji-target="'+n[s]+'" class="insert-emoji"><img class="marked-emoji" src="'+c+'"> '+n[s]+"</a></p></div>"),$('a[data-emoji-target="'+n[s]+'"]').click(function(){P(r,$(this).data("emoji-target")),e.modal("hide")})}t.hide(),o.show(),e.modal("handleUpdate")}),""!=i.val()&&r.setValue(i.val(),-1)})},$(function(){$(".main-martor").martor()}),"django"in window&&"jQuery"in window.django&&django.jQuery(document).on("formset:added",function(e,n){n.find(".main-martor").each(function(){var e=n.attr("id");e=e.substr(e.lastIndexOf("-")+1);var o=$(this.outerHTML.replace(/__prefix__/g,e));$(this).replaceWith(o),o.martor()})})}(martorJQuery);
